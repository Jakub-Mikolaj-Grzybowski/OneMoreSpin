services:
  # --- BACKEND (.NET API) ---
  backend:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: oms-backend
    ports:
      - "8080:8080" # API dostępne pod localhost:8080
    environment:
      # Podłączenie do bazy danych (używamy zmiennej z Portainera lub wpisz tu swoje dane)
      - ConnectionStrings__DefaultConnection=${DB_CONNECTION_STRING}
      - ASPNETCORE_ENVIRONMENT=Development
      # Konfiguracja CORS (pozwalamy frontendowi na połączenie)
      - AllowedOrigins=http://localhost:5173
    networks:
      - db-network

  # --- FRONTEND (React) ---
  frontend:
    build:
      context: .
      dockerfile: Dockerfile.ui
    container_name: oms-frontend
    ports:
      - "5173:5173" # Strona dostępna pod localhost:5173
    environment:
      # Frontend musi wiedzieć gdzie jest backend
      - VITE_API_URL=http://localhost:8080
    depends_on:
      - backend
    networks:
      - db-network

# Łączymy się do Twojej istniejącej sieci z bazą danych
networks:
  db-network:
    external: true
    name: db-network # Upewnij się, że tak nazwałeś sieć w stacku z bazą (infra-db)